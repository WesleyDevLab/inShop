<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org" 
                xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
                layout:decorator="admin/catalog/product">
	<head>
	<!-- layout:decorator="admin/category" -->
	    <th:block th:remove="all">
			<title>inShop Admin Product</title>
		    <meta charset="utf-8"/>
		    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		    <meta name="viewport" content="width=device-width, initial-scale=1"/>
		    <meta name="description" content=""/>
		    <meta name="author" content=""/>
		
		    <!-- Bootstrap Core CSS -->
		    <link href="../../../../resources/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" th:href="@{/resources/bower_components/bootstrap/dist/css/bootstrap.min.css}"/>
			<!-- Treegrid -->
		 	<link href="../../../../resources/css/jquery.treegrid.css" rel="stylesheet" th:href="@{/resources/css/jquery.treegrid.css}"/>
			<!-- summernote -->
			<link href="../../../../resources/css/summernote.css" rel="stylesheet" type="text/css" th:href="@{/resources/css/summernote.css}"></link>
			<!-- bootstrap select -->
			<link href="../../../../resources/css/bootstrap-select.min.css" rel="stylesheet" type="text/css" th:href="@{/resources/css/bootstrap-select.min.css}"></link>
		    <!-- Custom Fonts -->
	    	<link href="../../../../resources/bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" th:href="@{/resources/bower_components/font-awesome/css/font-awesome.min.css}"/>
			<link href="../../../../resources/bower_components/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css" th:href="@{/resources/bower_components/bootstrap/dist/css/bootstrap-theme.min.css}"></link>    	
	    	<link href="../../../../resources/css/sb-admin-2.css" rel="stylesheet" th:href="@{/resources/css/sb-admin-2.css}"/>   	
			<!-- style.css -->
    		<link href="../../../../resources/css/style.css" rel="stylesheet" type="text/css" th:href="@{/resources/css/style.css}"/>	    	
	    </th:block>
	</head>
<body>
  <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true" th:attr="data-path=@{/admin/catalog/product}" layout:fragment="editForm">
    <div class="modal-dialog" style="width:65vw;overflow-x:hidden;overflow-y: initial !important">
	   <div class="modal-content" id="editModalContent">
	   <form method="post" enctype="multipart/form-data" class="form-horizontal" id="pform" role="form" action="#" th:action="@{/admin/catalog/product/edit}" th:object="${product}" th:fragment="editProductForm">
		   <div class="modal-header">
	 			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title"  th:text="${!product.new}? #{admin.catalog.product.edit.title.edit}: #{admin.catalog.product.edit.title.add}">Edit Product</h4>
	 	   </div>
		 <!-- /modal-header -->
		    <div class="modal-body"  id="editModalBody">
		          <div  th:if="${#fields.hasErrors('*')}" class="alert alert-danger alert-dismissable">
		          	<button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                    <span th:text="#{admin.catalog.category.edit.existsErrors}">There is some errors in the form</span>
					<ul>
					  <li th:each="err : ${#fields.errors('*')}" th:text="${err}">Input is incorrect</li>
					</ul>                                 
                  </div>
	               <ul class="nav nav-tabs">
	                    <li th:class="${tabactive=='main'}? 'in active'"><a href="#main" data-toggle="tab" th:text="#{admin.edit.tab.description}">Описание</a>
	                    </li>
	                    <li th:class="${tabactive=='additional'}? 'in active'"><a href="#additional" data-toggle="tab" th:text="#{admin.edit.tab.params}">Параметры</a>
	                    </li>
	                    <li th:class="${tabactive=='images'}? 'in active'"><a href="#images" data-toggle="tab" th:text="#{admin.edit.tab.images}">Изображения</a>
	                    </li>
	                </ul>
	                <!-- Tab panes -->
	                <div class="tab-content" style ="height:50vh;overflow-x:hidden;overflow-y:auto">
	                    <div class="tab-pane fade" th:classappend="${tabactive=='main'}? 'in active'" id="main">
								   <div class="field-box" th:class="${#fields.hasErrors('name')}? has-error: field-box">
									  <input type="hidden" th:field="*{id}"/>	                              
						    		  <label>
							    	  	 <span th:text="#{admin.catalog.edit.name}">Product1</span>
							   		  </label>
							   		  <input type="text" class="form-control" th:field="*{name}"/>
							   		  <p class="text-danger" style="font-size: 8pt;" th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Incorrect name</p>
						   		   </div>					   		   
								   <div class="field-box">	                              
						    		  <label>
							    	  	 <span th:text="#{admin.catalog.url}">Url</span>
							   		  </label>
							   		  <input type="text" class="form-control" th:field="*{url}"/>
						   		   </div>
<!-- 						   		   <div class="container-fluid" style="width:100%;">						   		    -->
									   <div class="row">
								   		   <div class="col-md-3">
											   <div class="field-box">	                              
									    		  <label>
										    	  	 <span th:text="#{admin.catalog.product.articul}">Articul</span>
										   		  </label>
										   		  <input type="text" class="form-control" th:field="*{code}"/>
									   		   </div>
											</div>
								   		   <div class="col-md-3">
											   <div class="field-box">	                              
									    		  <label>
										    	  	 <span th:text="#{admin.catalog.product.retailPrice}">retail price</span>
										   		  </label>
										   		  <input type="text" class="form-control" th:field="*{retailPrice}"/>
									   		   </div>						   		   
								   		   </div>
								   		   <div class="col-md-3">
											   <div class="field-box">	                              
									    		  <label>
										    	  	 <span th:text="#{admin.catalog.product.salePrice}">sale price</span>
										   		  </label>
										   		  <input type="text" class="form-control" th:field="*{salePrice}"/>
									   		   </div>						   		   
								   		   </div>
								   		   <div class="col-md-3">
											   <div class="field-box">	                              
									    		  <label>
										    	  	 <span th:text="#{admin.catalog.product.costPrice}">cost price</span>
										   		  </label>
										   		  <input type="text" class="form-control" th:field="*{costPrice}"/>
									   		   </div>						   		   
								   		   </div>
<!-- 										</div>			 -->
									</div>			   		   
						   		   <div class="field-box">
			 			    		  <label>
							    	  	<span th:text="#{admin.catalog.category.edit.description}">Description Product1</span>
							   		   </label>
							   		   <input type="text" class="form-control" th:field="*{description}"/>
						   		   </div>
						   		   <div class="field-box">
			 			    		   <label>
							    	  	<span th:text="#{admin.catalog.category.edit.longDescription}">Description Product1</span>
							   		   </label>
								       <textarea id="summernote" class="textarea form-control" placeholder="Введите текст..." th:field="*{longDescription}"></textarea>
		  						   </div>
	             		</div>
	                    <div class="tab-pane fade" th:classappend="${tabactive=='additional'}? 'in active'" id="additional">
	                        <div class="field-box">
	                           <label>
						  	  	<span th:text="#{admin.catalog.category}">Category</span>
						       </label>
							   <select class="form-control" th:field="*{category}">
								<option th:each="scategory : ${allCategory}" 
								        th:value="${scategory.id}"
									    th:text="${scategory.name}"
									    th:class="${!scategory.enabled} ? 'text-muted'"
									    >Category 1</option>
							   </select>
						     </div>
						     <div class="row">
								<div class="col-md-6">
								    <div class="field-box">	 
				                        <label>
									  	  	<span th:text="#{admin.catalog.brand}">Brand</span>
									    </label>
										 <select class="form-control" th:field="*{brand}">
											<option th:each="sbrand : ${allBrand}" 
											        th:value="${sbrand.id}"
												    th:text="${sbrand.name}"
												    th:class="${!sbrand.enabled} ? 'text-muted'"
												    >Brand 1</option>
										 </select>
									</div>
							  </div>
							 <div class="col-md-6">	 
	   			   		        <div class="field-box">
		 			    		  <label>
						    	  	<span th:text="#{admin.catalog.model}">Model</span>
						   		  </label>
						   		  <input type="text" class="form-control" th:field="*{model}"/>
							    </div>					
						     </div>
						  </div>	  
   			   		       <div class="field-box">
	 			    		  <label>
					    	  	<span th:text="#{admin.catalog.category.edit.ordering}">Orderig</span>
					   		  </label>
					   		  <input type="text" class="form-control" th:field="*{ordering}"/>
						   </div>
						   <div class="row">
						   		<div class="col-md-2">
								   <div class="field-box">
			                         <label>
			 					    	<input type="checkbox" th:field="*{enabled}"/>
									  	<span th:text="#{admin.catalog.category.enabled}">Active?</span>
									 </label>
								   </div>
								</div>
								<div class="col-md-2">   	 
								   <div class="field-box">
			                         <label>
			 					    	<input type="checkbox" th:field="*{canSellWithoutOptions}"/>
									  	<span th:text="#{admin.catalog.category.product.canSellWithoutOptions}">canSWO?</span>
									 </label>
								   </div>
								</div>	 
						   </div>
	                    </div>
 	                    <div class="tab-pane fade" th:classappend="${tabactive=='images'}? 'in active'" id="images"> 
							<div class="container-fluid">	                    
							    <div class="row clearfix">
									<div class="col-md-12 column">
				                       	 <table class="table table-bordered table-hover" id="pImagesTable" data-checkid="">
				                       	    <thead >
					                       	   <tr >
					                       	      <th class="col-md-1 text-center"></th>
									              <th class="col-md-5 text-center" th:text="#{admin.catalog.product.image}">Image</th>
									              <th class="col-md-1 text-center"></th>
										  	   </tr>
									  	    </thead >
									  	    <tbody>
									  	       <tr th:each="image, imageStat : *{images}">
									              <td class="text-center">						
												     <input class="checkCategory" type="checkbox" th:id="${'check-'+image}" th:value="${image}"/>
											      </td>
									  	       	  <td class="text-center">
									  	       	    <input type="hidden" class="image-url" th:field="*{images[__${imageStat.index}__]}"/>
											        <div class="media" style="margin-top: 0;">
													  <div class="media-left media-middle">
													    <div class="photo-block"> 
							                                <span class="helper"></span>
							                                <img id="image" src="../../../../resources/img/logo/asus.png" style="width: 100px;"
							                                     th:src="@{${{image!=null}? image: '/resources/img/noimage.png'}}" th:onerror="'this.src=\'' + @{/resources/img/noimage.png} + '\';'"/>
						                                </div> 
						                              </div>
						                              <div class="media-body">
														  <p>
														     <span th:text="${image}">/images/image1.png</span>
														  </p>
						                              </div>   
						                            </div> 
									  	       	  </td>
									  	       	  <td>
			  				            	  		 <div class="btn-group edit-btn-group" role="group" > 
						                                  <button type="button" class="row-move-down btn btn-outline btn-default btn-xs">
						                                    <i class="fa fa-arrow-circle-up"></i>
						                                  </button>
							                              <button type="button" class="row-move-up btn btn-outline btn-default btn-xs"> 
							                                <i class="fa fa-arrow-circle-down"></i>
							                              </button>							                              
						                                  <button type="button" data-toggle="modal" data-target="#deleteModalImage" 
							                                      class="open-deleteImageDialog btn btn-outline btn-default btn-xs"
							                                      >
							                                <i class="fa fa-trash-o"></i>
							                              </button>	
					                            	 </div>
									  	       	  </td>
									  	       </tr>
											</tbody>
										</table>
									</div>
								</div>
								<span class="btn btn-outline btn-default btn-sm pull-left btn-file add-new-image">
									<span th:text="#{button.add.caption}">Добавить</span>
									<i class="fa fa-plus-circle"></i>
								    <input type="file" th:attr="data-path=@{/admin/catalog/product/image/add}" id="inputSImg" name="newImage" accept="image/jpeg,image/png,image/gif"/>
								</span>								
							</div>
	                    </div> 
	                </div>
		    </div>
		 <!-- /modal-body -->
	 	    <div class="modal-footer">
	 		  <!-- <button type="button" class="btn btn-default"  
	 		          th:text="#{admin.catalog.category.edit.button.close}"
	 		          th:onclick="'window.location=\''+@{/admin/catalog/category}+'\''">Close</button> -->
	 		  <button type="button" class="btn btn-default" data-dismiss="modal" th:text="#{admin.catalog.category.edit.button.close}">Close</button>        
			  <button type="submit" class="btn btn-primary" th:text="#{admin.catalog.category.edit.button.save}">Save changes</button>
		    </div>  
		 <!-- /modal-footer -->
	     </form>	
      </div> 
    </div> 
  </div>	    
   <!-- jQuery -->
   <script src="../../../../resources/bower_components/jquery/dist/jquery.min.js" th:src="@{/resources/bower_components/jquery/dist/jquery.min.js}"></script>
   <!-- Bootstrap Core JavaScript -->
   <script src="../../../../resources/bower_components/bootstrap/dist/js/bootstrap.min.js" th:src="@{/resources/bower_components/bootstrap/dist/js/bootstrap.min.js}"></script>
 
	   <th:block th:fragment="scriptEditModal">
		   <!-- Bootstrap bootstrap-wysiwyg.js -->
		   <script src="../../../../resources/js/summernote.js" th:src="@{/resources/js/summernote.js}"></script>
		   <script src="../../../../resources/js/summernote-ru-RU.js" th:src="@{/resources/js/summernote-ru-RU.js}"></script> 
		    <!-- bootstrap-select -->
		   <script src="../../../../resources/js/bootstrap-select.min.js" th:src="@{/resources/js/bootstrap-select.min.js}"></script>
		   <script src="../../../../resources/js/defaults-ru_RU.js" th:src="@{/resources/js/defaults-ru_RU.js}"></script>
	   </th:block>
   		<th:block layout:fragment="scriptEditModal"> 
	   	   <script type="text/javascript">
		     //<![CDATA[
		     $(document).ready(function() {
		    	 $("#editModal").modal("show");
	    			$(document).on('change', '.btn-file :file', function () { 
		    			var form = new FormData(document.forms.pform);
		    			var path= $(this).data("path");
		    			var formser;
		    			if (form != "undefined" && form != null) formser = form;
		    			//$("#pform").text("");
	                    $.ajax({
	                    	type: "POST",
	                        url: path,
	                        data: formser,
	                        cache: false,
	                        contentType: false,
	                        processData: false		                        
	                    }).done(function (html) {
	                                $("#pform").html(html);
	        	                    $("#summernote").summernote({
	        	    				    lang: "ru-RU"
	        	    				     });
	           			    	    var s = $("#pImagesTable tbody > tr:last-child").position();
	        			    	    $("#editModalBody" ).scrollTop( s.top );
	                    });
   		    	    });
    			    $(".row-move-up").click(function() {
	    			    var row = $(this).closest("tr");
	    			    var rowOther = row.next();
	    			    row.insertAfter(row.next());
	    			    var inp = $(row).find(".image-url");
	    			    var inpOther = $(rowOther).find(".image-url");
	    			    var indexOther = $(rowOther).index();
	    			    var index = $(row).index();
	    			    $(inp).attr("name","images["+index+"]");
	    			    $(inp).attr("id","images"+index);
	    			    $(inpOther).attr("name","images["+indexOther+"]");
	    			    $(inpOther).attr("id","images"+indexOther);	    			    
    			      });	    			   
    			    $('.row-move-down').click(function() {
    				    var row = $(this).closest('tr');
    				    var rowOther = row.prev(); 
    				    row.prev().insertAfter(row);
	    			    var inp = $(row).find(".image-url");
	    			    var inpOther = $(rowOther).find(".image-url");
	    			    var indexOther = $(rowOther).index();
	    			    var index = $(row).index();
	    			    $(inp).attr("name","images["+index+"]");
	    			    $(inp).attr("id","images"+index);
	    			    $(inpOther).attr("name","images["+indexOther+"]");
	    			    $(inpOther).attr("id","images"+indexOther);	    			    
    			    });     			   
	    			
			 });
	 		 $("#editModal").on("show.bs.modal", function (e) {
	                            $('#summernote').summernote({
	        					    lang: "ru-RU"
	          				     });
	                            $(".selectpicker").selectpicker();
	                   });
	 		 // ]]>
		   </script>
		 </th:block>  
</body>
</html>
